
## Google Cloud Memorystore for Redis のベスト プラクティス


### maxmemoryポリシーを指定する（済）
Redis インスタンスのメモリがいっぱいになり、新しい書き込みが発生すると、Redis はキーのエビクションを行い、インスタンスの maxmemory ポリシーに基づいて書き込み用にスペースを確保します。Memorystore for Redis のデフォルトの maxmemory ポリシーは volatile-lru です。次のいずれかの maxmemory ポリシーを使用することもできます。

allkeys-lru
- キーセット全体から、最も長い間使用されていない（LRU）キーを削除します。

### Memorystore for Redis v6以上を使う（済）
バージョン 6 を実行しているすべてのインスタンスで I/O マルチスレッドが有効になり、複数の vCPU を使用して I/O を同時に処理できるようになり、インスタンスのスループットが向上します。

### リードレプリカを使う
読み取りスループットが線形に拡張されます。フェイルオーバーには一般的に20〜30秒かかる

### RDBスナップショットを作成する
データの耐久性をさらに高めることができます。 


### アラート/モニタリングの設定する
Cloud Monitoringで
アラートでは、設定したしきい値に基づいて問題が発生したときに通知できます。

Cloud Monitoring を使用して、メインスレッド CPU 秒（redis.googleapis.com/stats/cpu_utilization_main_thread）指標にアラートを設定し、CPU 使用率がプライマリ ノードで 0.9 秒、各レプリカノードで 0.5 秒を超えないようにすることをおすすめします。

#### CPUの指標
call


### メンテナンス時間を設定する（済）
メンテナンスの開始時に、システム メモリ使用率メト​​リックが 50% 未満である必要がある
プライマリ ノードに障害が発生した場合はレプリカに自動的にフェイルオーバーします。
リードレプリカはデフォルトでは有効になっていません。

Memorystore はインスタンスを自動的に更新します。これらの更新は、インスタンスのセキュリティ、パフォーマンス、高可用性を維持するために不可欠であり、フルマネージド サービスであることの多くの利点の 1 つです。 

Memorystore for Redis では、メンテナンスを実行する特定の曜日の 1 時間のタイムスロットであるメンテナンス ウィンドウを定義する機能が提供されます。メンテナンスウィンドウを設定すると、メンテナンスがいつ発生するかを予測できます。インスタンスにメンテナンス時間枠が構成されていない場合、メンテナンスはいつでも、いつでも実行できます。これは、アプリケーションの使用量のピーク時にメンテナンスが発生する可能性があることを意味します。


#### メンテナンス通知をオプトインする(済)
インスタンスのメンテナンス更新がスケジュールされる少なくとも 7 日前に電子メールでアラートを受けるメンテナンス通知をオプトインする必要があります。
設定→通信からメール通知を受け取るように設定する（デフォルトOFFのため）
Memorystore の行で、メールボタンを [オン] に切り替えます


### 参考
https://dataintegration.info/google-cloud-memorystore-for-redis-best-practices-tips-for-a-highly-performant-and-worry-free-deployment